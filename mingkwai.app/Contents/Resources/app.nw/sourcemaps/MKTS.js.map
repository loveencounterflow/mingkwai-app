{"version":3,"sources":["MKTS.coffee"],"names":[],"mappings":"AASA;AAAA,MAAA,gHAAA;IAAA,gBAAA;;AAAA,EAAA,GAAA,GAA4B,OAAA,CAAQ,KAAR,CAA5B,CAAA;;AAAA,EACA,GAAA,GAA4B,GAAG,CAAC,GAAG,CAAC,IAAR,CAAa,GAAb,CAD5B,CAAA;;AAAA,EAEA,KAAA,GAA4B,YAF5B,CAAA;;AAAA,EAGA,GAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,OAAf,EAA0B,KAA1B,CAH5B,CAAA;;AAAA,EAIA,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA0B,KAA1B,CAJ5B,CAAA;;AAAA,EAKA,KAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,OAAf,EAA0B,KAA1B,CAL5B,CAAA;;AAAA,EAMA,KAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,OAAf,EAA0B,KAA1B,CAN5B,CAAA;;AAAA,EAOA,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA0B,KAA1B,CAP5B,CAAA;;AAAA,EAQA,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA0B,KAA1B,CAR5B,CAAA;;AAAA,EASA,OAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,SAAf,EAA0B,KAA1B,CAT5B,CAAA;;AAAA,EAUA,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA0B,KAA1B,CAV5B,CAAA;;AAAA,EAWA,IAAA,GAA4B,GAAG,CAAC,IAAI,CAAC,IAAT,CAAc,GAAd,CAX5B,CAAA;;AAsBA;AAAA,uDAtBA;;AAAA,EAuBA,WAAA,GAA4B,OAAA,CAAQ,aAAR,CAvB5B,CAAA;;AAAA,EAyBA,GAAA,GAA4B,IAzB5B,CAAA;;AAAA,EA0BA,IAAA,GAA4B,IA1B5B,CAAA;;AAAA,EA2BA,CAAA,GAA4B,SAAE,CAAF,EAAK,SAAL,GAAA;;MAAK,YAAY;KAAO;WAAA,CAAC,CAAC,OAAF,CAAU,SAAV,EAAxB;EAAA,CA3B5B,CAAA;;AAAA,EA6BA,UAAA,GAA4B,OAAA,CAAQ,cAAR,CA7B5B,CAAA;;AA+BA;AAAA,6BA/BA;;AAAA,EAgCA,GAAG,CAAC,IAAJ,CAAA,CAhCA,CAAA;;AAAA,EAsCA,MAAM,CAAC,OAAP,GAAiB,SAAE,IAAF,GAAA;AACf,IAAA,GAAA,GAAM,IAAN,CAAA;AACA,WAAO,IAAP,CAFe;EAAA,CAtCjB,CAAA;;AAAA,EA8CA,IAAC,CAAA,IAAD,GAAQ,EA9CR,CAAA;;AAAA,EAmGA,IAAC,CAAA,IAAI,CAAC,EAAN,GAAW,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,MAAF,GAAA;AAWT,UAAA,cAAA;AAAA,MAAA,MAAA,GAA0B,GAAK,CAAA,MAAA,CAA/B,CAAA;AAAA,MACA,MAAA,GAA0B,MAAA,GAAS,MADnC,CAAA;AAAA,MAEA,GAAK,CAAA,MAAA,CAAL,GAA0B,MAF1B,CAAA;AAAA,MAUA,GAAK,CAAA,QAAA,CAAU,CAAC,GAAhB,CAAoB,kBAApB,EAAwC,UAAxC,CAVA,CAAA;AAAA,MAWA,GAAK,CAAA,QAAA,CAAU,CAAC,UAAhB,CAA2B;AAAA,QAAA,KAAA,EAAO,MAAP;OAA3B,EAA0C,GAA1C,EAA+C,QAA/C,CAXA,CAAA;aAsBA,IAAA,CAAK,cAAA,GAAc,CAAC,CAAA,CAAE,MAAF,CAAD,CAAd,GAAwB,KAA7B,EAjCS;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAnGX,CAAA;;AAAA,EAuIA,IAAC,CAAA,IAAI,CAAC,EAAN,GAAW,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,MAAF,GAAA;AACT,UAAA,MAAA;AAAA,MAAA,MAAA,GAA0B,GAAK,CAAA,MAAA,CAA/B,CAAA;AAAA,MACA,GAAK,CAAA,MAAA,CAAL,GAA0B,MAD1B,CAAA;AAAA,MAEA,GAAK,CAAA,QAAA,CAAU,CAAC,UAAhB,CAA2B;AAAA,QAAA,KAAA,EAAO,MAAP;OAA3B,EAA0C,GAA1C,EAA+C,QAA/C,CAFA,CAAA;AAAA,MAGA,OAAA,CAAQ,WAAR,EAAqB,CAAA,CAAE,MAAF,CAArB,CAHA,CAAA;AAAA,MAIA,OAAA,CAAQ,WAAR,EAAqB,CAAA,CAAE,MAAF,CAArB,CAJA,CAAA;aAKA,IAAA,CAAK,cAAA,GAAc,CAAC,CAAA,CAAE,MAAF,CAAD,CAAd,GAAwB,KAA7B,EANS;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAvIX,CAAA;;AAAA,EAkJA,IAAC,CAAA,KAAD,GAAS,EAlJT,CAAA;;AAAA,EAqJA,IAAC,CAAA,KAAK,CAAC,KAAD,CAAN,GAAa,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,GAAA;AACX,UAAA,CAAA;AAAA,MAAA,CAAA,GACE;AAAA,QAAA,MAAA,EAAwB,IAAxB;AAAA,QACA,OAAA,EAAwB,IADxB;AAAA,QAEA,OAAA,EAAwB,IAFxB;AAAA,QAGA,KAAA,EAAwB,IAHxB;AAAA,QAIA,YAAA,EAAwB,IAJxB;AAAA,QAKA,YAAA,EAAwB,IALxB;OADF,CAAA;AAOA,aAAO,CAAP,CARW;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CArJb,CAAA;;AAAA,EAgKA,IAAC,CAAA,KAAK,CAAC,UAAP,GAAoB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,GAAA;AAClB;AAAA;;SAAA;AAAA,UAAA,mDAAA;AAAA,MAEE,aAAA,MAAF,EACE,aAAA,MAHF,CAAA;AAAA,MAIA,QAAA,GAAc,MAAA,CAAO,sEAAP,CAJd,CAAA;AAAA,MAKA,CAAE,MAAA,CAAO,MAAP,CAAF,CAAiB,CAAC,MAAlB,CAAyB,QAAzB,CALA,CAAA;AAAA,MAOA,KAAA,GAAgC,GAAK,CAAA,OAAA,CAPrC,CAAA;AAAA,MAQA,IAAA,GAAgC,KAAO,CAAA,MAAA,CARvC,CAAA;AAAA,MASA,KAAO,CAAA,OAAA,CAAP,GAAwB,KAAA,GAAQ,QAAA,CAAW,QAAQ,CAAC,GAAT,CAAa,OAAb,CAAX,EAAmC,EAAnC,CAThC,CAAA;AAAA,MAUA,KAAO,CAAA,OAAA,CAAP,GAAwB,KAAA,GAAQ,MAAM,CAAC,EAAE,CAAC,aAAV,CAAwB,QAAxB,EAAkC,OAAlC,CAVhC,CAAA;AAAA,MAWA,KAAO,CAAA,KAAA,CAAP,GAAgC,KAAA,GAAQ,KAXxC,CAAA;AAAA,MAYA,KAAO,CAAA,YAAA,CAAP,GAAgC,KAAA,GAAQ,IAZxC,CAAA;AAAA,MAaA,KAAO,CAAA,YAAA,CAAP,GAAgC,KAAA,GAAQ,IAbxC,CAAA;AAAA,MAeA,QAAQ,CAAC,MAAT,CAAA,CAfA,CAAA;AAgBA,aAAO,IAAP,CAjBkB;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAhKpB,CAAA;;AAAA,EAoLA,IAAC,CAAA,KAAK,CAAC,IAAP,GAAc,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,GAAA;AACZ,UAAA,CAAA;AAAA,MAAA,IAAiC,wCAAjC;AAAA,QAAE,KAAC,CAAA,KAAK,CAAC,UAAP,CAAkB,GAAlB,CAAF,CAAA;OAAA;AACA,aAAO,CAAP,CAFY;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CApLd,CAAA;;AAAA,EAyLA,IAAC,CAAA,KAAK,CAAC,WAAP,GAAqB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,EAAO,KAAP,GAAA;aAAkB,KAAA,GAAQ,CAAE,KAAC,CAAA,KAAK,CAAC,IAAP,CAAY,GAAZ,CAAF,CAAqB,CAAA,YAAA,EAA/C;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAzLrB,CAAA;;AAAA,EA0LA,IAAC,CAAA,KAAK,CAAC,WAAP,GAAqB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,EAAO,KAAP,GAAA;aAAkB,KAAA,GAAQ,CAAE,KAAC,CAAA,KAAK,CAAC,IAAP,CAAY,GAAZ,CAAF,CAAqB,CAAA,YAAA,EAA/C;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CA1LrB,CAAA;;AAAA,EA2LA,IAAC,CAAA,KAAK,CAAC,WAAP,GAAqB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,EAAO,IAAP,GAAA;aAAkB,IAAA,GAAQ,CAAE,KAAC,CAAA,KAAK,CAAC,IAAP,CAAY,GAAZ,CAAF,CAAqB,CAAA,YAAA,EAA/C;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CA3LrB,CAAA;;AAAA,EA4LA,IAAC,CAAA,KAAK,CAAC,WAAP,GAAqB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,EAAO,IAAP,GAAA;aAAkB,IAAA,GAAQ,CAAE,KAAC,CAAA,KAAK,CAAC,IAAP,CAAY,GAAZ,CAAF,CAAqB,CAAA,YAAA,EAA/C;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CA5LrB,CAAA;;AAAA,EAkMA,IAAC,CAAA,KAAD,GAAS,EAlMT,CAAA;;AAAA,EAqMA,IAAC,CAAA,KAAK,CAAC,MAAP,GAAgB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,GAAF,EAAO,MAAP,GAAA;AACd,UAAA,6CAAA;AAAA,MAAA,YAAA,GAAkB,QAAlB,CAAA;AAAA,MACE,QAAgB,OAAhB,KADF,CAAA;AAAA,MAEA,OAAA,GAAkB,KAAO,CAAA,SAAA,CAFzB,CAAA;AAAA,MAGA,SAAA,GAAkB,KAAO,CAAA,WAAA,CAHzB,CAAA;AAAA,MAIA,IAAA,GAAkB,KAAO,CAAA,MAAA,CAJzB,CAAA;AAKA,aAAO,SAAA,GAAU,YAAV,GAAuB,QAAvB,GAA+B,OAA/B,GAAuC,UAAvC,GAAiD,SAAjD,GAA2D,KAA3D,GAAgE,IAAhE,GAAqE,IAA5E,CANc;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CArMhB,CAAA;;AAAA,EAiNA,IAAC,CAAA,IAAD,GAAQ,EAjNR,CAAA;;AAAA,EAoNA,IAAC,CAAA,IAAI,CAAC,aAAN,GAAsB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,OAAF,GAAA;;QAAE,UAAU;OAChC;AAAA,MAAA,KAAA,CAAM,QAAN,EAAgB,GAAK,CAAA,MAAA,CAArB,CAAA,CAAA;AACA,MAAA,IAAG,GAAK,CAAA,MAAA,CAAL,KAAiB,OAApB;eAAiC,KAAC,CAAA,IAAI,CAAC,WAAN,CAAkB,OAAlB,EAAjC;OAAA,MAAA;eAAgE,KAAC,CAAA,IAAI,CAAC,UAAN,CAAiB,OAAjB,EAAhE;OAFoB;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CApNtB,CAAA;;AAAA,EAyNA,IAAC,CAAA,IAAI,CAAC,WAAN,GAAoB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,OAAF,GAAA;AAClB,UAAA,cAAA;;QADoB,UAAU;OAC9B;AAAA,MAAA,MAAA,GAAkB,GAAK,CAAA,QAAA,CAAvB,CAAA;AAAA,MACA,MAAA,GAAkB,GAAK,CAAA,QAAA,CADvB,CAAA;AAAA,MAEA,CAAE,MAAA,CAAO,iBAAP,CAAF,CAA6B,CAAC,GAA9B,CAAkC,SAAlC,EAA6C,CAAA,CAA7C,CAFA,CAAA;AAAA,MAGA,CAAE,MAAA,CAAO,gBAAP,CAAF,CAA6B,CAAC,GAA9B,CAAkC,SAAlC,EAA6C,CAAA,CAA7C,CAHA,CAAA;AAAA,MAIA,GAAK,CAAA,MAAA,CAAL,GAAkB,QAJlB,CAAA;AAKA,MAAA,IAAgB,eAAhB;eAAA,OAAA,CAAQ,IAAR,EAAA;OANkB;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAzNpB,CAAA;;AAAA,EAkOA,IAAC,CAAA,IAAI,CAAC,UAAN,GAAmB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAE,OAAF,GAAA;AACjB,UAAA,cAAA;;QADmB,UAAU;OAC7B;AAAA,MAAA,MAAA,GAAkB,GAAK,CAAA,QAAA,CAAvB,CAAA;AAAA,MACA,MAAA,GAAkB,GAAK,CAAA,QAAA,CADvB,CAAA;AAAA,MAEA,CAAE,MAAA,CAAO,gBAAP,CAAF,CAA6B,CAAC,GAA9B,CAAkC,SAAlC,EAA6C,CAAA,CAA7C,CAFA,CAAA;AAAA,MAGA,CAAE,MAAA,CAAO,iBAAP,CAAF,CAA6B,CAAC,GAA9B,CAAkC,SAAlC,EAA6C,CAAA,CAA7C,CAHA,CAAA;AAAA,MAIA,GAAK,CAAA,MAAA,CAAL,GAAkB,OAJlB,CAAA;AAKA,MAAA,IAAgB,eAAhB;eAAA,OAAA,CAAQ,IAAR,EAAA;OANiB;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAlOnB,CAAA;;AAAA,EA2OA,IAAC,CAAA,IAAI,CAAC,SAAN,GAAkB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAA,GAAA;AAChB,MAAA,GAAK,CAAA,QAAA,CAAU,CAAC,QAAQ,CAAC,IAAzB,GAAgC,GAAK,CAAA,QAAA,CAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,OAA9B,CAAsC,cAAtC,EAAsD,WAAtD,CAAhC,CAAA;AACA,aAAO,IAAP,CAFgB;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CA3OlB,CAAA;;AAAA,EA8RA,IAAI,CAAC,iBAAL,GAAyB,SAAE,EAAF,GAAA;WAEvB,MAAM,CAAC,KAAP,CAAA,EAFuB;EAAA,CA9RzB,CAAA;;AAAA,EAoSA,IAAI,CAAC,gBAAL,GAAwB,SAAE,EAAF,GAAA;AAAU,UAAU,IAAA,KAAA,CAAM,iBAAN,CAAV,CAAV;EAAA,CApSxB,CAAA;;AAAA,EAqSA,IAAI,CAAC,IAAL,GAAY,SAAE,EAAF,GAAA;AAAU,UAAU,IAAA,KAAA,CAAM,iBAAN,CAAV,CAAV;EAAA,CArSZ,CAAA;;AAAA,EA0SA,IAAI,CAAC,kBAAL,GAA0B,SAAE,EAAF,GAAA;AACxB;AAAA;;;;;;;;;OAAA;AAAA,QAAA,MAAA;AAAA,IASA,IAAA,CAAK,yBAAL,CATA,CAAA;AAAA,IAWA,IAAI,CAAC,iBAAL,CAAA,CAXA,CAAA;AAqGA;AAAA,8FArGA;AAsGA;AAAA;;;;OAtGA;AAAA,IA0GA,MAAA,GAAS,8fA1GT,CAAA;WA0HA,WAAW,CAAC,UAAZ,CAAuB,MAAvB,EAA+B,CAAA,SAAA,KAAA,GAAA;aAAA,SAAE,KAAF,GAAA;AAC7B,QAAA,IAAe,aAAf;AAAA,gBAAM,KAAN,CAAA;SAAA;eAEA,IAAA,CAAK,6BAAL,EAH6B;MAAA,EAAA;IAAA,CAAA,CAAA,CAAA,IAAA,CAA/B,EA3HwB;EAAA,CA1S1B,CAAA;;AAAA,EAgbA,IAAC,CAAA,IAAD,GAAQ,EAhbR,CAAA;;AAkbA;AAAA,2CAlbA;;AAmbA;AAAA,yEAnbA;;AAAA,EAqbA,IAAC,CAAA,IAAM,CAAA,UAAA,CAAP,GAAsB,OAAA,CAAQ,uBAAR,CArbtB,CAAA;;AAAA,EAwbA,IAAC,CAAA,IAAM,CAAA,UAAA,CAAP,GAIE;AAAA,IAAA,GAAA,EAAwB,SAAA,GAAA;aAAG,IAAI,CAAC,gBAAL,CAAsB,MAAtB,EAAH;IAAA,CAAxB;AAAA,IAIA,WAAA,EAAwB,SAAA,GAAA;aAAG,IAAI,CAAC,aAAL,CAAA,EAAH;IAAA,CAJxB;AAAA,IAKA,YAAA,EAAwB,SAAA,GAAA;aAAG,IAAI,CAAC,gBAAL,CAAA,EAAH;IAAA,CALxB;AAAA,IAaA,QAAA,EAAwB,SAAA,GAAA;aAAG,UAAU,CAAC,oBAAX,CAAA,EAAH;IAAA,CAbxB;GA5bF,CAAA;;AAAA,EA4cA,IAAC,CAAA,IAAI,CAAC,MAAN,GAAe,SAAE,KAAF,GAAA;AAEb,QAAA,4BAAA;AAAA,IAAA,IAAA,GAAY,KAAO,CAAA,OAAA,CAAnB,CAAA;AAAA,IACA,QAAA,GAAY,EADZ,CAAA;AAGA,IAAA,IAAyB,KAAO,CAAA,QAAA,CAAhC;AAAA,MAAA,QAAQ,CAAC,IAAT,CAAc,KAAd,CAAA,CAAA;KAHA;AAIA,IAAA,IAAyB,KAAO,CAAA,SAAA,CAAhC;AAAA,MAAA,QAAQ,CAAC,IAAT,CAAc,MAAd,CAAA,CAAA;KAJA;AAKA,IAAA,IAAyB,KAAO,CAAA,SAAA,CAAhC;AAAA,MAAA,QAAQ,CAAC,IAAT,CAAc,MAAd,CAAA,CAAA;KALA;AAMA,IAAA,IAAyB,KAAO,CAAA,UAAA,CAAhC;AAAA,MAAA,QAAQ,CAAC,IAAT,CAAc,OAAd,CAAA,CAAA;KANA;AAAA,IAOA,QAAQ,CAAC,IAAT,yDAAiD,IAAjD,CAPA,CAAA;AAAA,IAQA,QAAA,GAAY,QAAQ,CAAC,IAAT,CAAc,GAAd,CARZ,CAAA;AAAA,IAWA,IAAA,CAAO,GAAA,CAAI,QAAJ,CAAP,EAAuB,IAAvB,EAA6B,KAAK,CAAC,OAAnC,EAA4C,KAAK,CAAC,MAAlD,EAA0D,KAAK,CAAC,QAAhE,CAXA,CAAA;AAYA,IAAA,IAAG,mDAAH;AACE,MAAA,OAAA,CAAA,CAAA,CAAA;AACA,aAAO,KAAP,CAFF;KAAA,MAAA;AAKE,aAAO,IAAP,CALF;KAda;EAAA,CA5cf,CAAA;;AAieA;AAAA;;;;;;;;;;;;;;;;;;;;KAjeA;;AAAA,EA8kBA,IAAC,CAAA,SAAD,GAAa,EA9kBb,CAAA;;AAAA,EAilBA,IAAC,CAAA,SAAS,CAAC,KAAX,GAAmB,CAAA,SAAA,KAAA,GAAA;WAAA,SAAA,GAAA;AACjB,UAAA,2PAAA;AAAA,MAAA,EAAA,GAAwB,GAAK,CAAA,IAAA,CAA7B,CAAA;AAAA,MACA,GAAA,GAAwB,EAAE,CAAC,MAAM,CAAC,GAAV,CAAA,CADxB,CAAA;AAAA,MAEA,gBAAA,GAAwB,KAAC,CAAA,IAAM,CAAA,UAAA,CAAc,CAAA,iBAAA,CAAqB,CAAA,MAAA,CAFlE,CAAA;AAAA,MAGA,qBAAA,GAAwB,KAAC,CAAA,IAAM,CAAA,UAAA,CAAc,CAAA,iBAAA,CAAqB,CAAA,WAAA,CAHlE,CAAA;AAAA,MAKA,QAAA,GAAgB,IAAA,EAAE,CAAC,IAAH,CAAQ;AAAA,QAAA,IAAA,EAAM,SAAN;OAAR,CALhB,CAAA;AAMA,cAAO,QAAA,GAAW,OAAS,CAAA,UAAA,CAA3B;AAAA,aACO,QADP;AAEI,UAAA,QAAQ,CAAC,gBAAT,CAA0B,UAA1B,CAAA,CAFJ;AACO;AADP;AAKI,UAAA,IAAA,CAAK,mCAAA,GAAmC,CAAC,GAAA,CAAI,QAAJ,CAAD,CAAxC,CAAA,CALJ;AAAA,OANA;AAAA,MAaA,IAAA,CAAK,eAAL,CAbA,CAAA;AAcA;AAAA,WAAA,gBAAA;0CAAA;AACE,QAAA,IAAA,CAAK,IAAA,GAAK,SAAV,CAAA,CAAA;AAEA,QAAA,IAAG,SAAS,CAAC,UAAV,CAAqB,GAArB,CAAH;AACE,UAAA,IAAA,CAAK,WAAA,GAAY,SAAjB,CAAA,CAAA;AACA,mBAFF;SAFA;AAAA,QAMA,IAAA,GAAW,IAAA,EAAE,CAAC,IAAH,CAAA,CANX,CAAA;AAOA,aAAA,yBAAA;sDAAA;AACE,UAAA,GAAA,GAAoB,IAApB,CAAA;AAAA,UACA,MAAA,GAAoB,IADpB,CAAA;AAAA,UAEA,YAAA,GAAoB,IAFpB,CAAA;AAAA,UAGA,MAAA,GAAoB,IAHpB,CAAA;AAAA,UAIA,cAAA,GAAoB;AAAA,YAAE,OAAA,KAAF;WAJpB,CAAA;AAKA;AAAA,6CALA;AAMA,UAAA,IAAyC,yBAAzC;AAAA,YAAE,wBAAA,GAAF,EAAO,2BAAA,MAAP,CAAA;WANA;AAQA,UAAA,IAAG,WAAH;AACE,YAAA,IAAA,CAAK,MAAA,GAAO,KAAP,GAAa,IAAb,GAAiB,GAAjB,GAAqB,GAA1B,CAAA,CAAA;AAAA,YACA,OAA+B,GAAG,CAAC,KAAJ,CAAU,GAAV,CAA/B,EAAE,wFAAF,EAAmB,kBADnB,CAAA;AAAA,YAGA,MAAA,sDAAuD,MAHvD,CAAA;AAAA,YAIA,cAAgB,CAAA,KAAA,CAAhB,GAA0B,MAJ1B,CAAA;AAMA,YAAA,IAAG,YAAY,CAAC,MAAb,GAAsB,CAAzB;AACE,mBAAA,4EAAA;yDAAA;AACE,gBAAA,YAAc,CAAA,YAAA,CAAd,gEAAsE,WAAtE,CADF;AAAA,eAAA;AAAA,cAEA,cAAgB,CAAA,WAAA,CAAhB,GAAiC,YAAY,CAAC,IAAb,CAAkB,GAAlB,CAFjC,CADF;aAPF;WAAA,MAAA;AAYE,YAAA,IAAA,CAAK,MAAA,GAAO,KAAZ,CAAA,CAZF;WARA;AAsBA,UAAA,IAAO,cAAP;AACE,YAAG,CAAA,SAAE,SAAF,EAAa,KAAb,GAAA;qBACD,MAAA,GAAS,SAAA,GAAA;uBAAG,IAAA,CAAK,UAAA,GAAW,SAAX,GAAqB,KAArB,GAA0B,KAA1B,GAAgC,mBAArC,EAAH;cAAA,EADR;YAAA,CAAA,CAAH,CAAK,SAAL,EAAgB,KAAhB,CAAA,CADF;WAtBA;AAAA,UA0BA,cAAgB,CAAA,OAAA,CAAhB,GAA8B,MA1B9B,CAAA;AAAA,UA2BA,IAAI,CAAC,MAAL,CAAgB,IAAA,EAAE,CAAC,QAAH,CAAY,cAAZ,CAAhB,CA3BA,CADF;AAAA,SAPA;AAqCA;AAAA,oDArCA;AAAA,QAsCA,QAAA,GAAe,IAAA,EAAE,CAAC,QAAH,CAAY;AAAA,UAAA,KAAA,EAAO,SAAP;AAAA,UAAkB,SAAA,EAAW,IAA7B;SAAZ,CAtCf,CAAA;AAwCA,gBAAO,SAAP;AAAA,eACO,MADP;AAEI,YAAA,QAAQ,CAAC,MAAT,CAAgB,QAAhB,EAA0B,CAA1B,CAAA,CAFJ;AACO;AADP,eAGO,MAHP;AAII,YAAA,QAAQ,CAAC,MAAT,CAAgB,QAAhB,EAA0B,CAA1B,CAAA,CAJJ;AAGO;AAHP;AAMI,YAAA,QAAQ,CAAC,MAAT,CAAgB,QAAhB,CAAA,CANJ;AAAA,SAzCF;AAAA,OAdA;aAiEA,GAAG,CAAC,IAAJ,GAAY,SAlEK;IAAA,EAAA;EAAA,CAAA,CAAA,CAAA,IAAA,CAjlBnB,CAAA;;AAAA,EAspBA,IAAC,CAAA,SAAW,CAAA,aAAA,CAAZ,GACE;AAAA,IAAA,MAAA,EAEE;AAAA,MAAA,SAAA,EAA8B,IAA9B;AAAA,MACA,aAAA,EAA8B,IAD9B;AAAA,MAGA,UAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,IADxB;OAJF;AAAA,MAOA,qBAAA,EACE;AAAA,QAAA,GAAA,EAAwB,cAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;iBAAG,IAAI,CAAC,eAAL,CAAqB,GAArB,EAAH;QAAA,CADxB;OARF;AAAA,MAWA,kBAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;iBAAG,IAAI,CAAC,IAAL,CAAU,GAAV,EAAH;QAAA,CADxB;OAZF;AAAA,MAeA,2BAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;iBAAG,IAAI,CAAC,kBAAL,CAAwB,GAAxB,EAAH;QAAA,CADxB;OAhBF;KAFF;AAAA,IAqBA,MAAA,EAEE;AAAA,MAAA,mBAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;iBAAG,IAAI,CAAC,IAAI,CAAC,aAAV,CAAA,EAAH;QAAA,CADxB;OADF;AAAA,MAIA,oBAAA,EACE;AAAA,QAAA,MAAA,EAAwB,SAAA,GAAA;iBAAG,IAAI,CAAC,IAAI,CAAC,SAAV,CAAA,EAAH;QAAA,CAAxB;OALF;AAAA,MAOA,aAAA,EACE;AAAA,QAAA,GAAA,EAAwB,WAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;AAAG,UAAA,KAAA,CAAM,QAAN,EAAgB,SAAhB,CAAA,CAAA;iBAA4B,IAAI,CAAC,IAAI,CAAC,EAAV,CAAa,CAAA,GAAI,GAAK,CAAA,mBAAA,CAAtB,EAA/B;QAAA,CADxB;OARF;AAAA,MAWA,eAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;AAAG,UAAA,KAAA,CAAM,QAAN,EAAgB,UAAhB,CAAA,CAAA;iBAA4B,IAAI,CAAC,IAAI,CAAC,EAAV,CAAa,CAAb,EAA/B;QAAA,CADxB;OAZF;AAAA,MAeA,cAAA,EACE;AAAA,QAAA,GAAA,EAAwB,YAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;AAAG,UAAA,KAAA,CAAM,QAAN,EAAgB,UAAhB,CAAA,CAAA;iBAA4B,IAAI,CAAC,IAAI,CAAC,EAAV,CAAa,CAAA,GAAI,GAAK,CAAA,mBAAA,CAAtB,EAA/B;QAAA,CADxB;OAhBF;KAvBF;AAAA,IA0CA,MAAA,EACE;AAAA,MAAA,oBAAA,EAAgC,IAAhC;AAAA,MACA,iBAAA,EAA6B,IAD7B;AAAA,MAEA,4BAAA,EAAgC,IAFhC;KA3CF;AAAA,IA+CA,WAAA,EACE;AAAA,MAAA,SAAA,EACE;AAAA,QAAA,GAAA,EAAwB,QAAxB;AAAA,QACA,MAAA,EAAwB,SAAA,GAAA;iBAAG,KAAA,CAAM,QAAN,EAAgB,KAAhB,EAAH;QAAA,CADxB;OADF;KAhDF;GAvpBF,CAAA;AAAA","file":"MKTS.js","sourceRoot":"/source/","sourcesContent":["\n\n\n\n\n############################################################################################################\n# njs_path                  = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr.bind CND\nbadge                     = '眀快排字机/MKTS'\nlog                       = CND.get_logger 'plain',   badge\ninfo                      = CND.get_logger 'info',    badge\nalert                     = CND.get_logger 'alert',   badge\ndebug                     = CND.get_logger 'debug',   badge\nwarn                      = CND.get_logger 'warn',    badge\nurge                      = CND.get_logger 'urge',    badge\nwhisper                   = CND.get_logger 'whisper', badge\nhelp                      = CND.get_logger 'help',    badge\necho                      = CND.echo.bind CND\n# #...........................................................................................................\n# NW                        = require 'nw.gui'\n# win                       = NW.Window.get()\n# #...........................................................................................................\n# suspend                   = require 'coffeenode-suspend'\n# step                      = suspend.step\n# immediately               = suspend.immediately\n# after                     = suspend.after\n# sleep                     = suspend.sleep\n#...........................................................................................................\n### https://github.com/TooTallNate/node-applescript ###\nAPPLESCRIPT               = require 'applescript'\n#...........................................................................................................\napp                       = null\nMKTS                      = @\nƒ                         = ( x, precision = 2 ) -> x.toFixed precision\n#...........................................................................................................\nLINESETTER                = require './LINESETTER'\n#...........................................................................................................\n### provide ES6 features: ###\nCND.shim()\n\n\n#===========================================================================================================\n# INITIALIZER\n#-----------------------------------------------------------------------------------------------------------\nmodule.exports = ( _app ) ->\n  app = _app\n  return MKTS\n\n\n#===========================================================================================================\n# ZOOM\n#-----------------------------------------------------------------------------------------------------------\n@ZOOM = {}\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ZOOM.revert_zoom = ( me ) ->\n#   ### TAINT code duplication ###\n#   return unless ( last_zoom_level = me[ '%memo' ][ 'last-zoom-level' ] )?\n#   return @zoom_to me, last_zoom_level\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ZOOM.zoom_percent_from_level = ( me, level = null ) ->\n#   level ?= win.zoomLevel\n#   return ( level - me[ 'base-zoom-level' ] ) * 1.2 * 100\n\n  # me[ '%memo' ][ 'last-zoom-level' ]  = win.zoomLevel\n  # win.zoomLevel                       = level ? me[ 'base-zoom-level' ]\n  # #.........................................................................................................\n  # return win.zoomLevel\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ZOOM.zoom = ( me, delta ) ->\n#   me[ '%memo' ][ 'last-zoom-level' ]  = win.zoomLevel\n#   #.........................................................................................................\n#   if delta?\n#     if ( delta > 0 and win.zoomLevel <= 8.8 ) or ( delta < 0 and win.zoomLevel >= -7.5 )\n#       win.zoomLevel += delta\n#   #.........................................................................................................\n#   else\n#     win.zoomLevel = me[ 'base-zoom-level' ]\n#   #.........................................................................................................\n#   help \"zoomed to #{ƒ win.zoomLevel} (#{ƒ ( @zoom_percent_from_level me ), 0}%)\"\n#   return win.zoomLevel\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ZOOM._get_zoom_levels = =>\n#   ### TAINT more efficient to cache value as `app[ 'zoom' ]` or `app[ 'scale' ]` ###\n#   R           = []\n#   matcher     = /[-.e0-9]+/g\n#   idx         = -1\n#   matrix_txt  = app[ 'zoomer' ].css 'transform'\n#   while ( match = matcher.exec matrix_txt )?\n#     idx += 1\n#     R.push parseFloat match[ 0 ] if idx in [ 0, 3, ]\n#   return R\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ZOOM.to_delta = ( delta ) =>\n#   [ scale_x, scale_y, ] = @ZOOM._get_zoom_levels()\n#   scale_x              += delta\n#   scale_y              += delta\n#   app[ 'zoomer' ].css 'transform', \"matrix(#{scale_x}, 0, 0, #{scale_y}, 0, 0)\"\n#   help \"zoomed to [ #{ƒ scale_x}, #{ƒ scale_y}, ]\"\n\n#-----------------------------------------------------------------------------------------------------------\n@ZOOM.by = ( factor ) =>\n  # window                  = app[ 'window' ]\n  # q                       = app[ 'jQuery' ]\n  # document                = window.document\n  # width                   = ( q window ).width()\n  # height                  = ( q window ).height()\n  # left                    = ( q document ).scrollLeft()\n  # top                     = ( q document ).scrollTop()\n  # page_x                  = left + width  / 2\n  # page_y                  =  top + height / 2\n  # zmr                     = window.convertPointFromPageToNode ( app[ 'zoomer' ].get 0 ), page_x, page_y\n  zoom_0                  = app[ 'zoom' ]\n  zoom_1                  = zoom_0 * factor\n  app[ 'zoom' ]           = zoom_1\n  #.........................................................................................................\n  # ( q '#tg' ).css 'left', zmr[ 'x' ] - 5\n  # ( q '#tg' ).css 'top',  zmr[ 'y' ] - 5\n  # matrix  = app[ 'zoomer' ].css 'transform'\n  # app[ 'zoomer' ].css 'transform',        \"matrix(1, 0, 0, 1, 0, 0)\"\n  # app[ 'zoomer' ].css 'transform-origin', \"#{zmr[ 'x' ]}px #{zmr[ 'y' ]}px\"\n  # app[ 'zoomer' ].css 'transform', matrix\n  app[ 'zoomer' ].css 'transform-origin', \"top left\"\n  app[ 'zoomer' ].transition scale: zoom_1, 100, 'linear'\n  #.........................................................................................................\n  # echo 'factor:  ', ƒ factor\n  # echo 'zoom_0:  ', ƒ zoom_0\n  # echo 'zoom_1:  ', ƒ zoom_1\n  # echo 'width:   ', ƒ width\n  # echo 'height:  ', ƒ height\n  # echo 'left:    ', ƒ left\n  # echo 'top:     ', ƒ top\n  # echo 'page_x:  ', ƒ page_x\n  # echo 'page_y:  ', ƒ page_y\n  echo \"zoomed to [ #{ƒ zoom_1}, ]\"\n\n#-----------------------------------------------------------------------------------------------------------\n@ZOOM.to = ( zoom_1 ) =>\n  zoom_0                  = app[ 'zoom' ]\n  app[ 'zoom' ]           = zoom_1\n  app[ 'zoomer' ].transition scale: zoom_1, 100, 'linear'\n  whisper 'zoom_0:  ', ƒ zoom_0\n  whisper 'zoom_1:  ', ƒ zoom_1\n  help \"zoomed to [ #{ƒ zoom_1}, ]\"\n\n#===========================================================================================================\n# GAUGE\n#-----------------------------------------------------------------------------------------------------------\n@GAUGE = {}\n\n#-----------------------------------------------------------------------------------------------------------\n@GAUGE.new = ( app ) =>\n  R =\n    'd.mm':                 1000\n    'd.npx':                null\n    'd.rpx':                null\n    'rho':                  null\n    'rpx-per-mm':           null\n    'npx-per-mm':           null\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@GAUGE.set_ratios = ( app ) =>\n  ### Since the gauge is 1m = 1000mm wide, a thousandth of its width in pixels equals pixels per\n  millimeter: ###\n  { jQuery\n    window }  = app\n  gauge_jq    = jQuery \"<div id='meter-gauge' style='position:absolute;width:1000mm;'></div>\"\n  ( jQuery 'body' ).append gauge_jq\n  #.........................................................................................................\n  gauge                         = app[ 'gauge' ]\n  d_mm                          = gauge[ 'd.mm' ]\n  gauge[ 'd.npx'      ] = d_npx = parseInt ( gauge_jq.css 'width' ), 10\n  gauge[ 'd.rpx'      ] = d_rpx = window.BD.get_rectangle gauge_jq, 'width'\n  gauge[ 'rho'        ] =         d_npx / d_rpx\n  gauge[ 'rpx-per-mm' ] =         d_rpx / d_mm\n  gauge[ 'npx-per-mm' ] =         d_npx / d_mm\n  #.........................................................................................................\n  gauge_jq.detach()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@GAUGE._get = ( app ) =>\n  ( @GAUGE.set_ratios app ) unless ( ( R = app[ 'gauge' ] )[ 'rpx-per-mm' ] )?\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@GAUGE.mm_from_rpx = ( app, d_rpx ) => d_rpx / ( @GAUGE._get app )[ 'rpx-per-mm' ]\n@GAUGE.mm_from_npx = ( app, d_npx ) => d_npx / ( @GAUGE._get app )[ 'npx-per-mm' ]\n@GAUGE.rpx_from_mm = ( app, d_mm  ) => d_mm  * ( @GAUGE._get app )[ 'rpx-per-mm' ]\n@GAUGE.npx_from_mm = ( app, d_mm  ) => d_mm  * ( @GAUGE._get app )[ 'npx-per-mm' ]\n\n\n#===========================================================================================================\n# CARET\n#-----------------------------------------------------------------------------------------------------------\n@CARET = {}\n\n#-----------------------------------------------------------------------------------------------------------\n@CARET.as_url = ( app, matter ) =>\n  file_locator    = 'matter'\n  { caret }       = matter\n  page_nr         = caret[ 'page-nr'   ]\n  column_nr       = caret[ 'column-nr' ]\n  y_px            = caret[ 'y.px'      ]\n  return \"mkts://#{file_locator}#page:#{page_nr}/column:#{column_nr}/y:#{y_px}px\"\n\n\n#===========================================================================================================\n# VIEW\n#-----------------------------------------------------------------------------------------------------------\n@VIEW = {}\n\n#-----------------------------------------------------------------------------------------------------------\n@VIEW.toggle_galley = ( handler = null ) =>\n  debug '©0fZv5', app[ 'view' ]\n  if app[ 'view' ] is 'pages' then @VIEW.show_galley handler else @VIEW.show_pages handler\n\n#-----------------------------------------------------------------------------------------------------------\n@VIEW.show_galley = ( handler = null ) =>\n  window          = app[ 'window' ]\n  jQuery          = app[ 'jQuery' ]\n  ( jQuery 'artboard.galley'  ).css 'z-index', +1\n  ( jQuery 'artboard.pages'   ).css 'z-index', -1\n  app[ 'view' ]   = 'galley'\n  handler null if handler?\n\n#-----------------------------------------------------------------------------------------------------------\n@VIEW.show_pages = ( handler = null ) =>\n  window          = app[ 'window' ]\n  jQuery          = app[ 'jQuery' ]\n  ( jQuery 'artboard.pages'   ).css 'z-index', +1\n  ( jQuery 'artboard.galley'  ).css 'z-index', -1\n  app[ 'view' ]   = 'pages'\n  handler null if handler?\n\n#-----------------------------------------------------------------------------------------------------------\n@VIEW.test_page = =>\n  app[ 'window' ].location.href = app[ 'window' ].location.href.replace /index\\.html$/, 'test.html'\n  return null\n\n\n# #-----------------------------------------------------------------------------------------------------------\n# MKTS._detach_artboard = ( me ) ->\n#   ### TAINT `#mkts-top`, `#mkts-bottom` not honored; are they needed? ###\n#   return if me[ 'view-mode' ] is 'print'\n#   body      = $ 'body'\n#   artboard  = $ 'artboard'\n#   contents  = artboard.contents()\n#   artboard.detach()\n#   body.append contents\n#   me[ '%memo' ][ 'view-mode' ] = { contents, artboard, body, }\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# MKTS._reattach_artboard = ( me ) ->\n#   return if me[ 'view-mode' ] is 'dev'\n#   { contents, artboard, body, } = me[ '%memo' ][ 'view-mode' ]\n#   delete me[ '%memo' ][ 'view-mode' ]\n#   contents.detach()\n#   artboard.append contents\n#   body.append artboard\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# MKTS.switch_to_print_view = ( me ) ->\n#   help \"MKTS.switch_to_print_view\"\n#   return if me[ 'view-mode' ] is 'print'\n#   @_detach_artboard me\n#   me[ 'view-mode' ] = 'print'\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# MKTS.switch_to_dev_view = ( me ) ->\n#   help \"MKTS.switch_to_dev_view\"\n#   return if me[ 'view-mode' ] is 'dev'\n#   @_reattach_artboard me\n#   me[ 'view-mode' ] = 'dev'\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# MKTS.toggle_view = ( me ) ->\n#   switch view_mode = me[ 'view-mode' ]\n#     when 'print'  then @switch_to_dev_view    me\n#     when 'dev'    then @switch_to_print_view  me\n#     else throw new Error \"unknown view mode #{rpr view_mode}\"\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.open_print_dialog = ( me ) ->\n  # @switch_to_print_view me\n  window.print()\n  # @switch_to_dev_view me\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.open_save_dialog = ( me ) -> throw new Error \"not implemented\"\nMKTS.save = ( me ) -> throw new Error \"not implemented\"\n  # route   = '/tmp/mkts/index.html'\n  # njs_fs.writeFileSync route, ( $ 'html' ).outerHTML()\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.open_print_preview = ( me ) ->\n  ### NB the solution adopted here to get a quick shortcut to open a print preview of the current document\n  using AppleScript sending keys etc. is deeply flawed. Not only must tabbing be enabled in the\n  Accessibility Settings of the target machine, it would also appear that the outcome of such actions as\n  `click menu button \"PDF\" of window \"Print\"` are dependent on the OS language settings, and maybe even\n  OS version. Last but not least, it can experimentally be made plausible that it is the `repeat` loops\n  of the *previous* (not the *current*) script execution that really trigger the actions, which is\n  deeply unsatisfying and feels plain wrong. Furthermore, haphazard user actions such as hitting a key\n  or clicking during script execution may probably meddle with the intended flow of events. In short, the\n  solution as implemented is nothing more than a crude stop-gap. ###\n  help \"MKTS.open_print_preview\"\n  # @switch_to_print_view me\n  MKTS.open_print_dialog()\n  #.........................................................................................................\n  # script = \"\"\"\n  #   tell application \"System Events\"\n  #     tell process \"mingkwai\"\n  #       keystroke \"p\" using {shift down, command down}\n  #       repeat until exists window \"Print\"\n  #       end repeat\n  #       click menu button \"PDF\" of window \"Print\"\n  #       repeat until exists menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n  #       end repeat\n  #       click menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n  #     end tell\n  #   end tell\n  #   \"\"\"\n  # script = \"\"\"\n  #   local hasWindowPrint\n  #   local hasOpenInPreview\n  #   set hasWindowPrint    to false\n  #   set hasOpenInPreview  to false\n  #   tell application \"System Events\"\n  #     tell process \"mingkwai\"\n  #       keystroke \"p\" using {shift down, command down}\n  #       repeat 3 times\n  #         say \"trying to find print window\" using \"Pipe Organ\"\n  #         if exists window \"Print\" then\n  #           set hasWindowPrint to true\n  #           exit repeat\n  #         end if\n  #         delay 0.5\n  #       end repeat\n  #       if hasWindowPrint then\n  #         click menu button \"PDF\" of window \"Print\"\n  #         repeat 3 times\n  #           say \"trying to open in preview\" using \"Pipe Organ\"\n  #           if exists menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\" then\n  #             set hasOpenInPreview to true\n  #             exit repeat\n  #           end if\n  #           delay 0.5\n  #         end repeat\n  #         if hasOpenInPreview then\n  #           click menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n  #         end if\n  #       end if\n  #     end tell\n  #   end tell\n  #   if hasWindowPrint and hasOpenInPreview then\n  #     say \"enjoy\" using \"Good News\"\n  #   else\n  #     say \"i'm sorry\" using \"Good News\"\n  #   end if\n  #   \"\"\"\n  # script = \"\"\"\n  #   tell application \"System Events\"\n  #     tell process \"mingkwai\"\n  #       keystroke \"p\" using {shift down, command down}\n  #     end tell\n  #   end tell\n  #   delay 0.5\n  #   tell application \"System Events\"\n  #     -- tell process \"mingkwai\"\n  #       click menu button \"PDF\" of window \"Print\"\n  #     -- end tell\n  #   end tell\n  #   delay 0.5\n  #   tell application \"System Events\"\n  #     -- tell process \"mingkwai\"\n  #       click menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n  #     -- end tell\n  #   end tell\n  #   \"\"\"\n  # script = \"\"\"\n  #   tell application \"System Events\"\n  #     tell process \"mingkwai\"\n  #       keystroke \"p\" using {shift down, command down}\n  #       click menu button \"PDF\" of window \"Print\"\n  #       click menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n  #     end tell\n  #   end tell\n  #   \"\"\"\n      # tell process \"Preview\"\n      #   repeat until exists window \"Preview\"\n      #   end repeat\n      #   key code 48 using {shift down}\n      #   key code 48 using {shift down}\n      # end tell\n      # tell process \"Preview\"\n      #   keystroke \"p\" using {shift down, command down}\n      # end tell\n  ### thx to http://apple.stackexchange.com/a/36947/59895, http://www.jaimerios.com/?p=171 ###\n  ### TAINT Note the delay clauses. Since it is the previous execution of the script that takes the intended\n  actions, each script invocation will run indefinitely, even after the app process itself has been\n  terminated. Programming a Tight Loop in AppleScript will cause a noticeable CPU load which is reduced\n  to the permille level by the timeout. As stated above, this is nothing more than a stop-gap solution. ###\n  script = \"\"\"\n    tell application \"System Events\"\n      tell process \"mingkwai\"\n        keystroke \"p\" using {shift down, command down}\n        repeat until exists window \"Print\"\n          delay 0.1\n        end repeat\n        click menu button \"PDF\" of window \"Print\"\n        repeat until exists menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n          delay 0.1\n        end repeat\n        click menu item \"Open PDF in Preview\" of menu 1 of menu button \"PDF\" of window \"Print\"\n      end tell\n    end tell\n    \"\"\"\n  #.........................................................................................................\n  APPLESCRIPT.execString script, ( error ) =>\n    throw error if error?\n    # @switch_to_dev_view me\n    help \"MKTS.open_print_preview: ok\"\n\n\n\n\n#===========================================================================================================\n# KEYS\n#-----------------------------------------------------------------------------------------------------------\n@KEYS = {}\n\n### TAINT should live in its own module ###\n### TAINT consider using e.g. https://www.npmjs.com/package/combokeys ###\n#-----------------------------------------------------------------------------------------------------------\n@KEYS[ 'keycodes' ] = require './BLAIDDDRWG-keycodes'\n\n#-----------------------------------------------------------------------------------------------------------\n@KEYS[ 'bindings' ] =\n  # 'meta+plus':            -> MKTS.ZOOM.by 1 * app[ 'zoom-delta-factor' ]\n  # 'meta+minus':           -> MKTS.ZOOM.by 1 / app[ 'zoom-delta-factor' ]\n  # 'meta+0':               -> MKTS.ZOOM.to 1\n  'h':                    -> MKTS.toggle_tool_mode 'hand'\n  # 'g':                    -> MKTS.VIEW.toggle_galley()\n  # 'meta+shift+asterisk':  -> MKTS.zoom app, +0.1\n  # 'meta+shift+minus':     -> MKTS.zoom app, -0.1\n  'meta+left':            -> MKTS.scroll_to_top()\n  'meta+right':           -> MKTS.scroll_to_bottom()\n  #.........................................................................................................\n  # 'meta+p':               -> MKTS.print()\n  # 'meta+shift+p':         -> MKTS.open_print_dialog()\n  # 'meta+r':               -> MKTS.reload()\n  # 'meta+q':               -> MKTS.take_screenshot()\n  # 'meta+y':               -> MKTS.demo()\n  # 'meta+x':               -> LINESETTER._demo_pop_over()\n  'meta+x':               -> LINESETTER._demo_pop_over_async()\n\n#-----------------------------------------------------------------------------------------------------------\n@KEYS.on_key = ( event ) ->\n  # code      = event.keyCode ? event.which\n  code      = event[ 'which' ]\n  key_name  = []\n  #.........................................................................................................\n  key_name.push 'alt'   if event[ 'altKey'    ]\n  key_name.push 'ctrl'  if event[ 'ctrlKey'   ]\n  key_name.push 'meta'  if event[ 'metaKey'   ]\n  key_name.push 'shift' if event[ 'shiftKey'  ]\n  key_name.push ( @KEYS[ 'keycodes' ].get code ) ? code\n  key_name  = key_name.join '+'\n  #.........................................................................................................\n  # debug '©3rgXC', Array.from @KEYS[ 'keycodes' ].entries()\n  echo ( rpr key_name ), code, event.ctrlKey, event.altKey, event.location\n  if ( binding = @KEYS[ 'bindings' ][ key_name ] )?\n    binding()\n    return false\n  #.........................................................................................................\n  else\n    return true\n\n###\n    document.onkeypress = (e) ->\n      cid = parseInt ( e[ 'keyIdentifier' ].replace /^U\\+/, '' ), 16\n      cid = 0x3013 if ( CND.type_of cid ) isnt 'number'\n      debug '©sz3Ku', 'keyIdentifier',    e[ 'keyIdentifier'    ], rpr String.fromCodePoint cid\n      debug '©hRgmv', 'getModifierState \"Alt\"       ', e.getModifierState \"Alt\"\n      debug '©hRgmv', 'getModifierState \"AltGraph\"  ', e.getModifierState \"AltGraph\"\n      debug '©hRgmv', 'getModifierState \"CapsLock\"  ', e.getModifierState \"CapsLock\"\n      debug '©hRgmv', 'getModifierState \"Control\"   ', e.getModifierState \"Control\"\n      debug '©hRgmv', 'getModifierState \"Fn\"        ', e.getModifierState \"Fn\"\n      debug '©hRgmv', 'getModifierState \"FnLock\"    ', e.getModifierState \"FnLock\"\n      debug '©hRgmv', 'getModifierState \"Hyper\"     ', e.getModifierState \"Hyper\"\n      debug '©hRgmv', 'getModifierState \"Meta\"      ', e.getModifierState \"Meta\"\n      debug '©hRgmv', 'getModifierState \"NumLock\"   ', e.getModifierState \"NumLock\"\n      debug '©hRgmv', 'getModifierState \"OS\"        ', e.getModifierState \"OS\"\n      debug '©hRgmv', 'getModifierState \"ScrollLock\"', e.getModifierState \"ScrollLock\"\n      debug '©hRgmv', 'getModifierState \"Shift\"     ', e.getModifierState \"Shift\"\n      debug '©hRgmv', 'getModifierState \"Super\"     ', e.getModifierState \"Super\"\n      debug '©hRgmv', 'getModifierState \"Symbol\"    ', e.getModifierState \"Symbol\"\n      debug '©hRgmv', 'getModifierState \"SymbolLock\"', e.getModifierState \"SymbolLock\"\n\n###\n\n\n\n# #===========================================================================================================\n# # MENUS\n# #-----------------------------------------------------------------------------------------------------------\n# @MENUS = {}\n\n# #-----------------------------------------------------------------------------------------------------------\n# @MENUS.build = ->\n#   NW  = app[ 'NW' ]\n#   # win = app[ 'win' ]\n#   win = NW.Window.get()\n#   #.........................................................................................................\n#   help_menu = new NW.Menu()\n#   help_menu.append new NW.MenuItem label: 'about mingkwai'\n#   # help_menu.append new NW.MenuItem label: 'about 眀快排字机'\n#   help_menu.append new NW.MenuItem label: 'what you should know A'\n#   help_menu_entry = new NW.MenuItem label: 'Help', 'submenu': help_menu\n#   #.........................................................................................................\n#   file_menu = new NW.Menu()\n#   file_menu.append new NW.MenuItem label: 'New'\n#   file_menu.append new NW.MenuItem label: 'Open...', click: -> debug '©QccII', \"not yet implemented\"\n#   file_menu.append new NW.MenuItem label: 'Save',                   key: 's', modifiers: 'cmd',       click: -> urge \"saving...\"\n#   file_menu.append new NW.MenuItem label: 'Take Screenshot',        key: 's', modifiers: 'cmd-shift', click: -> MKTS.take_screenshot app\n#   file_menu.append new NW.MenuItem label: 'Typeset Demo',           key: 'y', modifiers: 'cmd',       click: -> MKTS.demo app\n#   # file_menu.append new NW.MenuItem label: 'Print...',               key: 'p', modifiers: 'cmd-shift', click: -> MKTS.open_print_dialog app\n#   file_menu.append new NW.MenuItem label: 'Open Print Preview...',  key: 'p', modifiers: 'cmd',       click: -> MKTS.open_print_preview app\n#   file_menu_entry = new NW.MenuItem label: 'File', 'submenu': file_menu\n#   #.........................................................................................................\n#   view_menu = new NW.Menu()\n#   # view_menu.append new NW.MenuItem label: 'Toggle Dev / Print View',  key: 't', modifiers: 'cmd',     click: -> MKTS.toggle_view app\n#   view_menu.append new NW.MenuItem label: 'Toggle Galley',            key: 't', modifiers: 'cmd',     click: -> MKTS.VIEW.toggle_galley()\n#   view_menu.append new NW.MenuItem label: 'View Test Page',                                           click: -> MKTS.VIEW.test_page()\n#   view_menu.append new NW.MenuItem label: 'Zoom In',   key: '+', modifiers: 'cmd', click: -> debug '©yVRqU', \"Zoom In\";  MKTS.ZOOM.by 1 * app[ 'zoom-delta-factor' ]\n#   view_menu.append new NW.MenuItem label: 'Zoom 100%', key: '0', modifiers: 'cmd', click: -> debug '©AINX1', \"Zoom 100\"; MKTS.ZOOM.to 1\n#   view_menu.append new NW.MenuItem label: 'Zoom Out',  key: '-', modifiers: 'cmd', click: -> debug '©KO8qN', \"Zoom Out\"; MKTS.ZOOM.by 1 / app[ 'zoom-delta-factor' ]\n#   # 'meta+plus':\n#   # 'meta+0':\n#   # 'meta+minus':\n#   # view_menu.append new NW.MenuItem label: 'Toggle Galley',            key: 't', modifiers: 'cmd',     click: -> console.log 'XXXXXXXXXXXX'\n#   view_menu_entry = new NW.MenuItem label: 'View', 'submenu': view_menu\n#   #.........................................................................................................\n#   win_menu  = new NW.Menu type: 'menubar'\n#   switch platform = process[ 'platform' ]\n#     when 'darwin'\n#       win_menu.createMacBuiltin 'mingkwai'\n#       # win_menu.createMacBuiltin '眀快排字机'\n#     else\n#       warn \"platform menus not supported for #{rpr platform}\"\n#   win_menu.insert file_menu_entry, 1\n#   win_menu.insert view_menu_entry, 3\n#   win_menu.append help_menu_entry\n#   win.menu  = win_menu\n#   # win_menu.items.push new NW.MenuItem label: 'Help', 'submenu': help_menu\n#   edit_menu_item = win.menu.items[ 2 ]\n#   # CND.dir edit_menu_item\n#   # CND.dir edit_menu_item.submenu\n#   edit_menu_item.submenu.insert ( new NW.MenuItem label: 'xxxxxxxxx' ), 1\n#   # debug '©RsQep', edit_menu_item.type\n#   #.........................................................................................................\n#   # edit_menu_item = win.menu.items[ 2 ]\n#   #.........................................................................................................\n#   return null\n\n\n# @ACTIONS = {}\n\n# @ACTIONS[ 'demo' ]\n# @ACTIONS[ 'demo-1' ]\n# @ACTIONS[ 'print' ]\n# @ACTIONS[ 'print-preview' ]\n# @ACTIONS[ 'open' ]\n# @ACTIONS[ 'save' ]\n# @ACTIONS[ 'save-as' ]\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ACTIONS[ 'view-test' ] = =>\n#   window.location.href = './test.html'\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ACTIONS[ 'tool-mode-hand' ] = =>\n#   @push_tool_mode 'hand'\n\n#===========================================================================================================\n# INTERFACE\n#-----------------------------------------------------------------------------------------------------------\n@INTERFACE = {}\n\n#-----------------------------------------------------------------------------------------------------------\n@INTERFACE.build = =>\n  NW                    = app[ 'NW' ]\n  win                   = NW.Window.get()\n  key_translations      = @KEYS[ 'keycodes' ][ 'os-translations' ][ 'keys'      ]\n  modyfier_translations = @KEYS[ 'keycodes' ][ 'os-translations' ][ 'modifiers' ]\n  #.........................................................................................................\n  win_menu  = new NW.Menu type: 'menubar'\n  switch platform = process[ 'platform' ]\n    when 'darwin'\n      win_menu.createMacBuiltin 'mingkwai'\n      # win_menu.createMacBuiltin '眀快排字机'\n    else\n      warn \"platform menus not supported for #{rpr platform}\"\n  #.........................................................................................................\n  help \"building menu\"\n  for menu_name, menu_description of @INTERFACE[ 'description' ]\n    urge \"  #{menu_name}\"\n    #.......................................................................................................\n    if menu_name.startsWith '('\n      warn \"skipping #{menu_name}\"\n      continue\n    #.......................................................................................................\n    menu = new NW.Menu()\n    for label, entry_description of menu_description\n      key               = null\n      action            = null\n      os_modifiers      = null\n      os_key            = null\n      entry_settings    = { label, }\n      ### TAINT test for duplicate keys ###\n      { key, action, }  = entry_description if entry_description?\n      #.....................................................................................................\n      if key?\n        urge \"    #{label} (#{key})\"\n        [ os_modifiers..., os_key, ] = key.split '+'\n        #...................................................................................................\n        os_key                  = key_translations[ os_key ] ? os_key\n        entry_settings[ 'key' ] = os_key\n        #...................................................................................................\n        if os_modifiers.length > 0\n          for os_modifier, modifier_idx in os_modifiers\n            os_modifiers[ modifier_idx ] = modyfier_translations[ os_modifier ] ? os_modifier\n          entry_settings[ 'modifiers' ]  = os_modifiers.join '-'\n      else\n        urge \"    #{label}\"\n      #.....................................................................................................\n      unless action?\n        do ( menu_name, label ) =>\n          action = -> warn \"action '#{menu_name} > #{label}' not implemented\"\n      #.....................................................................................................\n      entry_settings[ 'click' ]   = action\n      menu.append new NW.MenuItem entry_settings\n    #.......................................................................................................\n    ### Build sub-menu and add it to menu bar: ###\n    sub_menu = new NW.MenuItem label: menu_name, 'submenu': menu\n    #.......................................................................................................\n    switch menu_name\n      when 'File'\n        win_menu.insert sub_menu, 1\n      when 'View'\n        win_menu.insert sub_menu, 3\n      else\n        win_menu.append sub_menu\n  #.........................................................................................................\n  # edit_menu_item = win.menu.items[ 2 ]\n  # edit_menu_item.submenu.insert ( new NW.MenuItem label: 'xxxxxxxxx' ), 1\n  win.menu  = win_menu\n\n#-----------------------------------------------------------------------------------------------------------\n@INTERFACE[ 'description' ] =\n  'File':\n    #.......................................................................................................\n    '%%% New':                    null\n    '%%% Open...':                null\n    #.......................................................................................................\n    '%%% Save':\n      key:                    'meta+s'\n      action:                 null\n    #.......................................................................................................\n    '%%% Take Screenshot':\n      key:                    'meta+shift+s'\n      action:                 -> MKTS.take_screenshot app\n    #.......................................................................................................\n    '%%% Typeset Demo':\n      key:                    'meta+y'\n      action:                 -> MKTS.demo app\n    #.......................................................................................................\n    '%%% Open Print Preview...':\n      key:                    'meta+p'\n      action:                 -> MKTS.open_print_preview app\n  #---------------------------------------------------------------------------------------------------------\n  'View':\n    #.......................................................................................................\n    '%%% Toggle Galley':\n      key:                    'meta+t'\n      action:                 -> MKTS.VIEW.toggle_galley()\n    #.......................................................................................................\n    '%%% View Test Page':\n      action:                 -> MKTS.VIEW.test_page()\n    #.......................................................................................................\n    '%%% Zoom In':\n      key:                    'meta+plus'\n      action:                 -> debug '©yVRqU', \"Zoom In\";  MKTS.ZOOM.by 1 * app[ 'zoom-delta-factor' ]\n    #.......................................................................................................\n    '%%% Zoom 100%':\n      key:                    'meta+0'\n      action:                 -> debug '©AINX1', \"Zoom 100\"; MKTS.ZOOM.to 1\n    #.......................................................................................................\n    '%%% Zoom Out':\n      key:                    'meta+minus'\n      action:                 -> debug '©KO8qN', \"Zoom Out\"; MKTS.ZOOM.by 1 / app[ 'zoom-delta-factor' ]\n  #---------------------------------------------------------------------------------------------------------\n  'Help':\n    '%%% about mingkwai':           null\n    '%%% About 眀快排字机':           null\n    '%%% What you should know A':   null\n  #---------------------------------------------------------------------------------------------------------\n  '(no menu)':\n    '%%% foo':\n      key:                    'meta+f'\n      action:                 -> debug '©hXLSk', 'foo'\n\n\n\n\n\n"]}