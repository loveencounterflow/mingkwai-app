{"version":3,"sources":["browser.coffee"],"names":[],"mappings":"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","file":"browser.js","sourceRoot":"/source/","sourcesContent":["\n\n\n############################################################################################################\nnjs_path                  = require 'path'\nnjs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr.bind CND\nbadge                     = '眀快排字机/browser'\nlog                       = CND.get_logger 'plain',   badge\ninfo                      = CND.get_logger 'info',    badge\nalert                     = CND.get_logger 'alert',   badge\ndebug                     = CND.get_logger 'debug',   badge\nwarn                      = CND.get_logger 'warn',    badge\nurge                      = CND.get_logger 'urge',    badge\nwhisper                   = CND.get_logger 'whisper', badge\nhelp                      = CND.get_logger 'help',    badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nNW                        = require 'nw.gui'\nwin                       = NW.Window.get()\n#...........................................................................................................\nsuspend                   = require 'coffeenode-suspend'\nstep                      = suspend.step\nimmediately               = suspend.immediately\nafter                     = suspend.after\nsleep                     = suspend.sleep\n#...........................................................................................................\nD                         = require 'pipedreams'\nD$                        = D.remit.bind D\nCHR                       = require 'coffeenode-chr'\n#...........................................................................................................\nLINESETTER                = require './LINESETTER'\n#...........................................................................................................\nƒ                         = ( x, precision = 2 ) -> x.toFixed precision\n\n### see https://github.com/nwjs/nw.js/wiki/Window ###\nsplash_info = [ './splash.html',\n  \"position\":         \"center\",\n  \"title\":            \"眀快排字机\",\n  \"width\":            800,\n  \"height\":           500,\n  \"frame\":            false,\n  \"toolbar\":          false,\n  \"transparent\":      true,\n  \"focus\":            false,\n  \"resizable\":        false,\n  \"show\":             true,\n  \"show_in_taskbar\":  true,\n  ]\n\n#-----------------------------------------------------------------------------------------------------------\nsplash_win = NW.Window.open splash_info...\n\n#-----------------------------------------------------------------------------------------------------------\n### Description of what is being typeset; the document. ###\n### At some point in the future, maybe we'll be able to refer to the matter (document) and to locations\ninside the matter by using a URL like:\n\n    mkts://#{file_locator}#page:#{page_nr}/column:#{column_nr}/y:#{insertion_y_px}px\n\ne.g.\n\n    mkts://(file:///Users/dave/Documents/cv.mkts)/page:3/column:4/y:120.45px\n###\nmatter =\n  '~isa':                 'MKTS/matter'\n  'batch-idx':            -1\n  'pages':                []\n  'caret':\n    'page-nr':            1\n    'column-nr':          1\n    'y.px':               0\n\n#-----------------------------------------------------------------------------------------------------------\n### Description of the app, its settings and its current user interface state. ###\napp =\n  '~isa':                 'MKTS/app'\n  '%memo':                {}\n  ### TAINT populate with `MKTS.new_windows()` ###\n  '%windows':\n    'main':                 win\n    'devtools':             null\n    'splash':               splash_win\n  # 'mm-per-px':            100 / 377.94791\n  # 'mm-per-px':            55 / 203.704\n  # 'mm-per-px':            160 / 593\n  'gauge':                null\n  'jQuery':               $\n  'NW':                   NW\n  'MKTS':                 null\n  'artboard':             null\n  'window':               window\n  'view-mode':            'dev'\n  'zoom-delta-factor':    1.25\n  'zoom':                 1\n  'tool-modes':           []\n  'tool-modes-default':   'default'\n  'view':                 'pages'\n  'matter':               matter\n\n\n#-----------------------------------------------------------------------------------------------------------\n### Publish app so we have access to it in both the browser and the NodeJS contexts: ###\nwindow[ 'app' ] = app\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS = ( require './MKTS' ) app\n### TAINT temporary fix: ###\napp[ 'MKTS' ]   = MKTS\napp[ 'gauge' ]  = MKTS.GAUGE.new app\n\n\n# win.zoomLevel = 0 # 100%\n# win.setResizable yes\n# win.resizeTo 1500, 1500\n# win.setTransparent yes # ???\n# win.showDevTools()\n# win.setProgressBar 0.5 # visible on dock icon\n# win.setBadgeLabel = 'helo from 眀快排字机' # ???\n\n# help '©5t3', document.visibilityState\n# CND.dir win\n# help ( name for name of window).join ' '\n\n\n# win.on 'blur',              -> info 'blur'\n# win.on 'capturepagedone',   -> info 'capturepagedone'\nwin.on 'close',             -> info 'close'; @close true\n# win.on 'closed',            -> info 'closed'\n# win.on 'devtools-closed',   -> info 'devtools-closed'\n# win.on 'devtools-opened',   -> info 'devtools-opened'\n# win.on 'document-end',      -> info 'document-end'\n# win.on 'document-start',    -> info 'document-start'\n# win.on 'enter-fullscreen',  -> info 'enter-fullscreen'\n# win.on 'focus',             -> info 'focus'\n# win.on 'leave-fullscreen',  -> info 'leave-fullscreen'\n# win.on 'loaded',            -> info 'loaded'\n# win.on 'loading',           -> info 'loading'\n# win.on 'maximize',          -> info 'maximize'\n# win.on 'minimize',          -> info 'minimize'\n# win.on 'move',              -> info 'move'\n# win.on 'new-win-policy',    -> info 'new-win-policy'\n# win.on 'resize',            -> info 'resize'\n# win.on 'restore',           -> info 'restore'\n# win.on 'unmaximize',        -> info 'unmaximize'\n# win.on 'zoom',              -> info 'zoom'\n# debug '©AfAsc', 'window.devicePixelRatio  ', window.devicePixelRatio\n# debug '©AfAsc', 'window.devicePixelRatio  ', window.devicePixelRatio\n# debug '©igYFq', 'window.screen.availTop   ', window.screen.availTop\n# debug '©VUTiB', 'window.screen.availLeft  ', window.screen.availLeft\n# debug '©o8v8T', 'window.screen.availHeight', window.screen.availHeight\n# debug '©Ubkrt', 'window.screen.availWidth ', window.screen.availWidth\n# debug '©zvq8U', 'window.screen.colorDepth ', window.screen.colorDepth\n# debug '©nH9a6', 'window.screen.height     ', window.screen.height\n# debug '©YDbG3', 'window.screen.left       ', window.screen.left\n# debug '©j0QXK', 'window.screen.orientation', window.screen.orientation\n# debug '©wEUqB', 'window.screen.pixelDepth ', window.screen.pixelDepth\n# debug '©G5QV3', 'window.screen.top        ', window.screen.top\n# debug '©7Kqfv', 'window.screen.width      ', window.screen.width\n\n# #-----------------------------------------------------------------------------------------------------------\n# win.on 'resize', ->\n#   info \"resized to #{win.width} x #{win.height}\"\n\n# #-----------------------------------------------------------------------------------------------------------\n# win.on 'move', ->\n#   info \"moved to #{win.x}, #{win.y}\"\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.get_document_size = ( me ) -> [ ( $ 'html' ).outerWidth(), ( $ 'html' ).outerHeight(), ]\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.maximize = ( app ) ->\n  win.moveTo   window.screen.availLeft,  window.screen.availTop\n  win.resizeTo window.screen.availWidth, window.screen.availHeight\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.wait = ( handler ) ->\n  window.requestAnimationFrame -> handler()\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.take_screenshot = ->\n  step ( resume ) =>\n    ### trying to wait for DOM reflow: ###\n    # yield step.wrap window.requestAnimationFrame, resume\n    yield MKTS.wait resume\n    # help 'animation frame'\n    img       = yield MKTS._capture win, resume\n    img_route = '/tmp/nw.png'\n    yield njs_fs.writeFile img_route, img, resume\n    help \"image written to #{img_route}\"\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.scroll_to = ( label ) ->\n  # log '©Rafbc', ( $ '#bottom' ).offset\n  ( $ 'html, body' ).stop().animate { scrollTop: ( $ label ).offset().top }, 500\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.scroll_to_top    = -> @scroll_to '#mkts-top'\nMKTS.scroll_to_bottom = -> @scroll_to '#mkts-bottom'\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS._capture = ( win, handler ) ->\n  win.capturePage ( ( img ) => handler null, img ), format: 'png', datatype: 'buffer'\n\ndemo_count = 0\n#-----------------------------------------------------------------------------------------------------------\nMKTS.demo = ( me ) ->\n  debug '©iNl2F', 'demo'\n  # source = \"\"\"<em>Ab<xsmall>c</xsmall>d<xbig>e</xbig>ffiVA</em>\"\"\"\n  # source = \"\"\"Xxxxxxxxxxxxxxxx, she noticed xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\"\"\n  # source = \"\"\"\n\n\n  #   # Behind the Looking-Glass\n  #   'But everything's curious today. I think I may as well go in at once.' And in\n  #   she went.\n\n  #   # Behind the Looking-Glass\n\n  #   Just as she said this, she noticed that one of the trees had a door\n  #   leading right into it. 'That's very curious!' she thought. 'But\n  #   everything's <xbig>curious</xbig> today. I think I may as well go in at once.' And in\n  #   she went.\n\n  #   上古時期的越南語很可能具有南亞語系其他語言現在具有的一些共同特徵，例如在屈折方面較發達，具有豐富的複輔音等。這些特徵已不再存於現代的越南語中，據認為是由於越南語地處東南亞的“語言聯盟”中，受到周邊有聲調的孤立語的影響，也變成了一種有聲調的孤立語。形態上的孤立和聲調的存在可能並非來源自原始南亞語，周邊的無親屬關係的語言，例如壯侗語系的泰語和南島語系的回輝話，也都具有聲調。\n\n  #   Just as shé said this, she fluffi *noticed* that\n  #   one of the trees had a door\n  #   leading right into it. 'That's very curious!' she thought.\n\n  #   Just as shé said this, she fluffi *noticed* that\n  #   one of the trees had a door\n  #   leading right into it. 'That's very curious!' she thought.\n\n  #   Just as shé said this, she fluffi *noticed* that\n  #   one of the trees had a door\n  #   leading right into it. 'That's very curious!' she thought.\n\n  #   Just as shé said this, she fluffi *noticed* that\n  #   one of the trees had a door\n  #   leading right into it. 'That's very curious!' she thought.\n  #   \"\"\"\n  # source = \"one <xbig>line</xbig>\\n\\n\" +  source[ .. 500 ] + ( 'ddd' for i in [ 0 .. 150 ] ).join ' '\n  # demo_count += +1\n  # if demo_count is 1\n  #   source = \"\"\"\n  #     # Test\n\n  #     just a **test**. *ffi*. abcdefghijklm Q Qu Queen the most unbelievable story.\"\"\"\n  # debug '©uvL5t', source.length\n  # source = \"Just as shé said this, she fluffi *noticed* that abc def ghi jkl mno pqr stu vwx xy\"\n  source = \"\"\"\n\n\n    'But everything's curious today. I think I may as well go in at once.' And in\n    she went.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx and so on.\n\n    bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\n\n    Short paragraph.\n\n  \"\"\"\n\n    # supercalifragilisticexpialigoricalsupercalifragilisticexpialigorical\n\n    # Sedutperspiciatisundeomnisistenatuserrorsitvoluptatemaccusantiumdoloremquelaudantium,totamremaperiam,eaqueipsaquaeabilloinventoreveritatisetquasiarchitectobeataevitaedicta sunt explicabo.\n\n    # # Behind the Looking-Glass\n\n\n    # The King and Queen of Hearts were <xbig>seated</xbig> on their throne when they\n    # arrived, with a great crowd assembled about them--all sorts of little\n    # birds and beasts.\n\n    # There was nothing so VERY remarkable in that; nor did Alice think it so\n    # VERY much out of the way to hear the Rabbit say to itself, 'Oh dear!\n    # Oh dear! I shall be late!' (when she thought it over afterwards, it\n    # occurred to her that she ought to have wondered at this, but at the time\n    # it all seemed quite natural); but when the Rabbit actually TOOK A WATCH\n    # OUT OF ITS WAISTCOAT-POCKET, and looked at it, and then hurried on,\n    # Alice started to her feet, for it flashed across her mind that she had\n    # never before seen a rabbit with either a waistcoat-pocket, or a watch\n    # to take out of it, and burning with curiosity, she ran across the field\n    # after it, and fortunately was just in time to see it pop down a large\n    # rabbit-hole under the hedge.\n\n\n    # 'Come, there's no use in crying like that!' said Alice to herself,\n    # rather sharply; 'I advise you to leave off this minute!' She generally\n    # gave herself very good advice, (though she very seldom followed it),\n    # and sometimes she scolded herself so severely as to bring tears into\n    # her eyes; and once she remembered trying to box her own ears for having\n    # cheated herself in a game of croquet she was playing against herself,\n    # for this curious child was very fond of pretending to be two people.\n    # 'But it's no use now,' thought poor Alice, 'to pretend to be two people!\n    # Why, there's hardly enough of me left to make ONE respectable person!'\n\n\n\n\n  # source = \"\"\"\n  #   <kwic-lineup>1 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>2 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>3 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>4 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>5 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>6 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>7 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>8 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>9 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>10 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>11 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>12 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>13 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>14 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>15 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>16 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>17 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>18 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>19 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>20 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>21 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>22 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>23 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>24 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>25 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>26 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>27 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>28 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>29 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>30 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>31 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>32 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>33 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>34 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>35 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>36 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>37 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>38 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>39 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>40 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>41 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>42 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>43 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>44 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>45 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>46 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>47 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>48 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>49 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>50 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>51 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>52 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>53 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>54 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>55 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>56 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>57 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>58 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>59 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>60 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>61 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>62 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>63 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>64 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>65 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>66 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>67 中國皇帝</kwic-lineup>\n  #   <kwic-lineup>68 中國皇帝</kwic-lineup>\n  #   \"\"\"\n  # source = require './demo-text'\n  # source = njs_fs.readFileSync '/tmp/kwic.html', encoding: 'utf-8'\n  # source = ( ( if line.length is 0 or line is '```' then line else \"#{line}<!--##{idx}-->\" ) for line, idx in source.split '\\n' ).join '\\n'\n  help \"source: approx. #{source.length} characters\"\n  settings =\n    # 'format':   'html'\n    'format':   'md'\n  step ( resume ) =>\n    # yield MKTS.VIEW.show_galley resume\n    yield LINESETTER.demo me, source, settings, resume\n    # MKTS.revert_zoom me\n    help \"MKTS.demo ok\"\n  return null\n\n\n\n\n### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  ###\n###  # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # ###\n### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  ###\n###  # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # ###\n### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  ###\n###  # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # ###\n### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  ###\n###  # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # ###\n\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.toggle_tool_mode = ( mode ) ->\n  return @pop_tool_mode() if ( CND.last_of app[ 'tool-modes' ] ) is mode\n  return @push_tool_mode mode\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.push_tool_mode = ( mode ) ->\n  debug '©2ryq9', app[ 'tool-modes' ]\n  app[ 'tool-modes' ].push mode unless ( CND.last_of app[ 'tool-modes' ] ) is mode\n  app[ 'tool-modes' ].shift() if app[ 'tool-modes' ].length > 10\n  # ( $ 'body' ).css 'cursor', 'url(./icons/mkts-tool-hand.png)'\n  # ( $ 'body' ).attr 'style', 'cursor:url(./icons/mkts-tool-hand-cursor.png), auto;'\n  ### TAINT must swap classes ###\n  ### TAINT how to make cursor visible after change? ###\n  ( $ 'body' ).addClass 'cursor-hand'\n  # ( $ app[ 'document' ] ).trigger 'mousemove'\n  return mode\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.pop_tool_mode = ->\n  debug '©2ryq9', app[ 'tool-modes' ]\n  if app[ 'tool-modes' ].length < 1\n    R = app[ 'tool-modes-default' ]\n  else\n    R = app[ 'tool-modes' ].pop()\n  ### TAINT must swap classes ###\n  ( $ 'body' ).removeClass 'cursor-hand'\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nMKTS.enable_console = ( selector = '#console' ) ->\n  console = $ '#console'\n  return unless console.length > 0\n  _write  = process.stderr.write.bind process.stderr\n  process.stderr.write = ( P... ) ->\n      # process.stdout.write '***' + P[ 0 ]\n      [ text, ... ] = P\n      lines = ( text.replace /\\n$/, '' ).split '\\n'\n      for line in lines\n        console.append $ \"<div>#{CND.ANSI.as_html text}</div>\"\n        console.stop().animate { scrollTop: ( $ '#console-bottom' ).offset()[ 'top' ] }, 500\n        # console.scrollTop ( $ '#console-bottom' ).offset()[ 'top' ]\n      _write P...\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nwin.on 'zoom', ->\n  MKTS.GAUGE.set_ratios app\n\n#-----------------------------------------------------------------------------------------------------------\nwin.on 'document-end', ->\n  # dev_win = win.showDevTools()\n  # dev_win.moveTo 1200, 848\n  # dev_win.maximize()\n  # dev_win.blur()\n  #.........................................................................................................\n  show_splash = no\n  if show_splash\n    after 2, ->\n      win.show()\n      splash_win.focus()\n    after 3, ->\n      win.focus()\n    after 4, ->\n      splash_win.hide()\n  else\n      splash_win.hide()\n      win.show()\n      win.focus()\n  #.........................................................................................................\n  app[ 'artboard' ] = $ 'artboard'\n  app[ 'zoomer'   ] = $ 'zoomer'\n  MKTS.enable_console()\n  step ( resume ) ->\n    # MKTS.maximize app\n    # MKTS.ZOOM.to app, 1.85\n    win.zoomLevel = 1\n    # MKTS.ZOOM.to app[ 'zoom' ]\n    yield step.wrap ( $ document ).ready, resume\n    help \"document ready\"\n    #.......................................................................................................\n    ### TAINT should be implicitly performed by MKTS.KEYS ###\n    ( $ document ).keydown MKTS.KEYS.on_key.bind MKTS\n    MKTS.INTERFACE.build()\n  #.........................................................................................................\n  return null\n\n###\n\n{\n  \"name\": \"mingkwai\"\n\n  \"main\": \"lib/index.html\",\n  \"version\": \"0.1.0\",\n  \"keywords\": [\n    \"node-webkit\",\n    \"typesetting\",\n    \"Chinese\",\n    \"Japanese\",\n    \"CJK\",\n    \"typography\"\n  ],\n  \"chromium-args\": \"--enable-remote-fonts --enable-region-based-columns --enable-webkit-text-subpixel-positioning --enable-devtools-experiments --enable-experimental-web-platform-features --enable-smooth-scrolling --disable-accelerated-video --enable-webgl --enable-webaudio --ignore-gpu-blacklist --force-compositing-mode --remote-debugging-port=10138 --harmony\",\n  \"single-instance\": true,\n  \"no-edit-menu\": false,\n  \"window\": {\n    \"x\": 0,\n    \"y\": 20,\n    \"width\": 1200,\n    \"height\": 800,\n    \"show\": false,\n    \"show_in_taskbar\": true,\n    \"focus\": false,\n    \"toolbar\": true,\n    \"frame\": true,\n    \"icon\": \"./favicon.ico\",\n    \"position\": \"center\",\n    \"title\": \"眀快排字机\",\n    \"resizable\": true\n  },\n  \"js-flags\": \"--harmony\",\n  \"dependencies\": {\n    \"applescript\": \"^1.0.0\",\n    \"cnd\": \"^0.1.5\",\n    \"coffeenode-chr\": \"^0.1.4\",\n    \"coffeenode-suspend\": \"^0.1.4\",\n    \"coffeenode-teacup\": \"^0.1.2\",\n    \"linear-interpolator\": \"^1.0.2\",\n    \"pipedreams\": \"^0.2.8\",\n    \"stylus\": \"^0.49.3\"\n  }\n}\n\n###\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}