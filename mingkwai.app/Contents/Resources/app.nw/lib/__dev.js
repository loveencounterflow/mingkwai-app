// Generated by CoffeeScript 1.9.0
(function() {
  var $, CND, D, HOTMETAL, PIPEDREAMS, after, alert, badge, debug, echo, help, info, log, njs_fs, njs_path, rpr, sleep, step, suspend, urge, warn, whisper;

  njs_path = require('path');

  njs_fs = require('fs');

  CND = require('cnd');

  rpr = CND.rpr.bind(CND);

  badge = '眀快排字机/__dev';

  log = CND.get_logger('plain', badge);

  info = CND.get_logger('info', badge);

  alert = CND.get_logger('alert', badge);

  debug = CND.get_logger('debug', badge);

  warn = CND.get_logger('warn', badge);

  urge = CND.get_logger('urge', badge);

  whisper = CND.get_logger('whisper', badge);

  help = CND.get_logger('help', badge);

  echo = CND.echo.bind(CND);

  suspend = require('coffeenode-suspend');

  step = suspend.step;

  after = suspend.after;

  sleep = suspend.sleep;

  D = PIPEDREAMS = require('pipedreams2');

  $ = D.remit.bind(D);

  HOTMETAL = D.HOTMETAL;

  this.demo = function() {
    var input, live, md, mm_from_px, t0, t1_a, ƒ;
    md = "\n# Behind the Looking-Glass\n\nJust as she said this, she noticed that one of the trees had a door\nleading right into it. 'That's very curious!' she thought. 'But\neverything's curious today. I think I may as well go in at once.' And in\nshe went.\n\n# Behind the Looking-Glass\n\nJust as she said this, she noticed that one of the trees had a door\nleading right into it. 'That's very curious!' she thought. 'But\neverything's curious today. I think I may as well go in at once.' And in\nshe went.";
    md = "'But everything's curious today.\n\nx y v";
    mm_from_px = function(px) {
      return px * app['mm-per-px'];
    };
    ƒ = function(x, precision) {
      if (precision == null) {
        precision = 2;
      }
      return x.toFixed(precision);
    };
    input = D.create_throughstream();
    live = true;
    live = false;
    t0 = +new Date();
    t1_a = null;
    input.pipe(D.MD.$as_html()).pipe(D.HTML.$parse(true, true)).pipe(D.HTML.$slice_toplevel_tags()).pipe($((function(_this) {
      return function(block_hotml, send) {
        var idx, previous_element, previous_text, this_element, this_text, _i, _ref;
        for (idx = _i = _ref = block_hotml.length - 1; _i >= 1; idx = _i += -1) {
          this_element = block_hotml[idx];
          previous_element = block_hotml[idx - 1];
          if (CND.isa_text(this_text = this_element[1])) {
            if (CND.isa_text(previous_text = previous_element[1])) {
              if (previous_text[previous_text.length - 1] === '\u00ad') {
                this_element[1] = '\u00ad' + this_text;
                previous_element[1] = previous_text.slice(0, previous_text.length - 1);
              }
            }
          }
          block_hotml.splice(idx, 0, [[['cork', {}]], '', [['cork']]]);
        }
        return send(block_hotml);
      };
    })(this))).pipe(D.$show()).pipe((function(_this) {
      return function() {
        return $(function(block_hotml, send) {
          var html;
          return send(html = HOTMETAL.as_html(block_hotml, false));
        });
      };
    })(this)()).pipe(D.$show());
    input.write(md);
    return input.end();
  };

  if (module.parent == null) {
    this.demo();
  }

}).call(this);
